{"version":3,"file":"ws.js","sourceRoot":"","sources":["../../src/browser/ws.ts"],"names":[],"mappings":";AAAA,mCAAqC;AAErC,MAAM,iBAAkB,SAAQ,qBAAY;IAE1C,YAAa,GAAW;QACtB,KAAK,EAAE,CAAA;QACP,IAAI,CAAC,GAAG,GAAG,IAAI,SAAS,CAAC,GAAG,CAAC,CAAA;QAC7B,IAAI,CAAC,GAAG,CAAC,UAAU,GAAG,aAAa,CAAA;QACnC,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;QAChD,IAAI,CAAC,GAAG,CAAC,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,CAAA;QAC9C,IAAI,CAAC,GAAG,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA;QAChD,IAAI,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,GAAG,EAAE,EAAE;YAC3B,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAA;QAC7C,CAAC,CAAA;IACH,CAAC;IAED,IAAI,CAAE,GAAW,EAAE,EAAyB;QAC1C,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,KAAK,SAAS,CAAC,UAAU,IAAI,IAAI,CAAC,GAAG,CAAC,UAAU,KAAK,SAAS,CAAC,IAAI,EAAE;YAC1F,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAA;YACzB,OAAO,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAA;SACrB;aAAM;YACL,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC,CAAA;SAClD;IACH,CAAC;IASD,IAAI,KAAK,CAAC;IAEV,KAAK;QACH,IAAI,CAAC,GAAG,CAAC,KAAK,EAAE,CAAA;IAClB,CAAC;CACF;AAED,iBAAS,iBAAiB,CAAA","sourcesContent":["import { EventEmitter } from 'events'\n\nclass WebSocketPolyfill extends EventEmitter {\n  private _ws: WebSocket\n  constructor (uri: string) {\n    super()\n    this._ws = new WebSocket(uri)\n    this._ws.binaryType = 'arraybuffer'\n    this._ws.onerror = this.emit.bind(this, 'error')\n    this._ws.onopen = this.emit.bind(this, 'open')\n    this._ws.onclose = this.emit.bind(this, 'close')\n    this._ws.onmessage = (msg) => {\n      this.emit('message', Buffer.from(msg.data))\n    }\n  }\n\n  send (msg: Buffer, cb: (err?: Error) => void) {\n    if (this._ws.readyState === WebSocket.CONNECTING || this._ws.readyState === WebSocket.OPEN) {\n      this._ws.send(msg.buffer)\n      process.nextTick(cb)\n    } else {\n      process.nextTick(cb, new Error('already closed'))\n    }\n  }\n\n  /**\n   * This does not seem necessary to implement:\n   * see: https://github.com/interledgerjs/ilp-plugin-btp/commit/9975a2129f55fe57a16686beb66c22363ffbea7f#diff-7890877dd7f005f29976f46177e3e756R142\n   * see: https://github.com/websockets/ws/blob/master/lib/sender.js#L47\n   * see: https://github.com/websockets/ws/blob/master/lib/sender.js#L173\n   */\n  // tslint:disable-next-line:no-empty\n  ping () {}\n\n  close () {\n    this._ws.close()\n  }\n}\n\nexport = WebSocketPolyfill\n"]}